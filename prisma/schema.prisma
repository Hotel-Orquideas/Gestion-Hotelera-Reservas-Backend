generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Hotel {
  id          Int        @id @default(autoincrement())
  nit         String     @unique @db.VarChar(100)
  name        String     @db.VarChar(100)
  address     String     @db.VarChar(100)
  city        String     @db.VarChar(30)
  email       String     @unique @db.VarChar(100)
  phoneNumber String     @map("phone_number") @db.VarChar(30)
  bill        Bill[]
  booking     Booking[]
  client      Client[]
  employee    Employee[]
  room        Room[]
  service     Service[]

  @@map("Hotels")
}

model Person {
  id           Int          @id @default(autoincrement())
  name         String       @db.VarChar(60)
  lastName     String       @map("last_name") @db.VarChar(100)
  typeDocument TypeDocument @default(CC) @map("type_document")
  document     String       @db.VarChar(100)
  genre        Genre?
  birthdate    DateTime?    @db.Date
  phoneNumber  String       @map("phone_number") @db.VarChar(30)
  email        String?      @unique @db.VarChar(50)
  bloodType    String?      @map("blood_type") @db.VarChar(4)
  client       Client[]
  employee     Employee[]

  @@map("Persons")
}

model Employee {
  id         Int         @id @default(autoincrement())
  position   String      @db.VarChar(50)
  state      StateEntity @default(B)
  createdAt  DateTime    @default(now()) @map("created_at")
  personId   Int         @map("person_id")
  roleId     Int         @map("role_id")
  hotelId    Int         @map("hotel_id")
  hotel      Hotel       @relation(fields: [hotelId], references: [id])
  person     Person      @relation(fields: [personId], references: [id])
  role       Role        @relation(fields: [roleId], references: [id])
  credential Credential?

  @@map("Employees")
}

model Credential {
  id         Int      @id @default(autoincrement())
  userName   String   @map("user_name") @db.VarChar(100)
  password   String   @db.VarChar(255)
  employeeId Int      @unique @map("employee_id")
  employee   Employee @relation(fields: [employeeId], references: [id])

  @@map("Credentials")
}

model Role {
  id       Int        @id @default(autoincrement())
  name     String     @db.VarChar(50)
  employee Employee[]

  @@map("Roles")
}

model Client {
  id                 Int             @id @default(autoincrement())
  dateIssuanceDoc    DateTime?       @map("date_issuance_doc")
  countryOrigin      String?         @map("country_origin") @db.VarChar(50)
  countryDestination String?         @map("country_destination") @db.VarChar(50)
  cityOrigin         String?         @map("city_origin") @db.VarChar(50)
  cityDestination    String?         @map("city_destination") @db.VarChar(50)
  profession         String?         @db.VarChar(50)
  state              StateEntity     @default(A)
  personId           Int             @map("person_id")
  hotelId            Int             @map("hotel_id")
  hotel              Hotel           @relation(fields: [hotelId], references: [id])
  person             Person          @relation(fields: [personId], references: [id])
  clientCompany      ClientCompany[]
  BookingClient      BookingClient[]
  Bill               Bill[]

  @@map("Clients")
}

model Company {
  id            Int             @id @default(autoincrement())
  name          String          @db.VarChar(50)
  nit           String          @unique @db.VarChar(100)
  email         String          @unique @db.VarChar(50)
  phoneNumber   String          @map("phone_number") @db.VarChar(30)
  legalAgent    String          @map("legal_agent") @db.VarChar(50)
  state         StateEntity     @default(A)
  clientCompany ClientCompany[]
  promotion     Promotion[]
  Booking       Booking[]

  @@map("Companies")
}

model ClientCompany {
  clientId  Int     @map("client_id")
  companyId Int     @map("company_id")
  client    Client  @relation(fields: [clientId], references: [id])
  company   Company @relation(fields: [companyId], references: [id])

  @@id([clientId, companyId])
  @@map("Clients_companies")
}

model Promotion {
  id             Int      @id @default(autoincrement())
  description    String   @db.VarChar(255)
  percentage     Float    @db.Float
  expirationDate DateTime @map("expiration_date") @db.Date
  companyId      Int      @map("company_id")
  company        Company  @relation(fields: [companyId], references: [id])

  @@map("Promotions")
}

model PaymentMethod {
  id             Int              @id @default(autoincrement())
  name           String           @db.VarChar(20)
  paymentHistory PaymentHistory[]

  @@map("Payment_methods")
}

model Bill {
  id             Int              @id @default(autoincrement())
  date           DateTime         @db.Date
  total          Int              @db.Int
  hotelId        Int              @map("hotel_id")
  clientId       Int              @map("client_id")
  hotel          Hotel            @relation(fields: [hotelId], references: [id])
  client         Client           @relation(fields: [clientId], references: [id])
  BookingRate    BookingRate[]
  paymentHistory PaymentHistory[]
  BillDetail     BillDetail[]

  @@map("Bills")
}

model BillDetail {
  id          Int      @id @default(autoincrement())
  description String   @db.VarChar(100)
  date        DateTime @db.DateTime()
  value       Int      @db.Int
  billId      Int      @map("bill_id")
  bill        Bill     @relation(fields: [billId], references: [id])

  @@map("Bill_details")
}

model PaymentHistory {
  id              Int           @id @default(autoincrement())
  valueToPay      Int           @map("value_to_pay")
  dateOfPay       DateTime      @map("date_of_pay") @db.Date
  balanceDue      Int           @map("balance_due")
  billId          Int           @map("bill_id")
  paymentMethodId Int           @map("payment_method_id")
  bill            Bill          @relation(fields: [billId], references: [id])
  paymentMethod   PaymentMethod @relation(fields: [paymentMethodId], references: [id])

  @@map("Payments_history")
}

model RoomType {
  id           Int    @id @default(autoincrement())
  name         String @db.VarChar(50)
  numMaxGuests Int    @map("num_max_guests")
  rate         Rate[]
  room         Room[]

  @@map("Room_types")
}

model Rate {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(50)
  value      Int
  roomTypeId Int      @map("room_type_id")
  roomType   RoomType @relation(fields: [roomTypeId], references: [id])

  @@map("Rates")
}

model Room {
  id          Int           @id @default(autoincrement())
  number      String        @db.VarChar(10)
  state       StateRoom     @default(A)
  roomTypeId  Int           @map("room_type_id")
  hotelId     Int           @map("hotel_id")
  hotel       Hotel         @relation(fields: [hotelId], references: [id])
  roomType    RoomType      @relation(fields: [roomTypeId], references: [id])
  bookingRoom BookingRoom[]

  @@map("Rooms")
}

model Service {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(100)
  pricePerUnit Int           @map("price_per_unit")
  hotelId      Int           @map("hotel_id")
  hotel        Hotel         @relation(fields: [hotelId], references: [id])
  roomService  RoomService[]

  @@map("Services")
}

model RoomService {
  id                   Int         @id @default(autoincrement())
  quantity             Int
  serviceId            Int         @map("service_id")
  bookingRoomBookingId Int         @map("booking_room_booking_id")
  bookingRoomRoomId    Int         @map("booking_room_room_id")
  bookingRoom          BookingRoom @relation(fields: [bookingRoomBookingId, bookingRoomRoomId], references: [bookingId, roomId])
  service              Service     @relation(fields: [serviceId], references: [id])

  @@map("Room_services")
}

model Booking {
  id            Int             @id @default(autoincrement())
  checkInDate   DateTime        @map("check_in_date") @db.DateTime(0)
  checkOutDate  DateTime        @map("check_out_date") @db.DateTime(0)
  details       String          @db.VarChar(255)
  hotelId       Int             @map("hotel_id")
  companyId     Int?            @map("company_id")
  hotel         Hotel           @relation(fields: [hotelId], references: [id])
  company       Company?        @relation(fields: [companyId], references: [id])
  bookingRoom   BookingRoom[]
  BookingClient BookingClient[]

  @@map("Bookings")
}

model BookingRoom {
  bookingId   Int           @map("booking_id")
  roomId      Int           @map("room_id")
  discount    Int?
  booking     Booking       @relation(fields: [bookingId], references: [id])
  room        Room          @relation(fields: [roomId], references: [id])
  bookingRate BookingRate[]
  roomService RoomService[]

  @@id([bookingId, roomId])
  @@map("Booking_rooms")
}

model BookingRate {
  id                   Int         @id @default(autoincrement())
  billId               Int         @map("bill_id")
  bookingRoomBookingId Int         @map("booking_room_booking_id")
  bookingRoomRoomId    Int         @map("booking_room_room_id")
  bill                 Bill        @relation(fields: [billId], references: [id])
  bookingRoom          BookingRoom @relation(fields: [bookingRoomBookingId, bookingRoomRoomId], references: [bookingId, roomId])

  @@map("Booking_rates")
}

model BookingClient {
  clientId  Int     @map("client_id")
  bookingId Int     @map("booking_id")
  client    Client  @relation(fields: [clientId], references: [id])
  booking   Booking @relation(fields: [bookingId], references: [id])

  @@id([clientId, bookingId])
  @@map("Booking_clients")
}

enum TypeDocument {
  CC
  PA
  TI
  CE
}

enum Genre {
  M
  F
  O
}

enum StateRoom {
  A //Available
  M //Maintenence
  O //OutServive
}

enum StateEntity {
  A // Active
  B // Block
  D // Delete
  I // Inactive
}
